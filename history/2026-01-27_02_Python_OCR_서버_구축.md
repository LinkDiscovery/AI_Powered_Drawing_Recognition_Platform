# Python OCR 서버 구축

**날짜**: 2026-01-27  
**작업 시간**: 약 1시간  
**목표**: FastAPI와 EasyOCR을 사용한 독립적인 Python OCR 서버 구축

---

## 📋 작업 개요

기존 Spring Boot 백엔드의 Mock OCR 구현을 실제 OCR 기능으로 대체하기 위해, Python 기반의 독립적인 OCR 마이크로서비스를 구축했습니다.

---

## 🎯 주요 성과

### 1. 프로젝트 구조 생성

```
ai-server/
├── app/
│   ├── __init__.py
│   ├── main.py              # FastAPI 애플리케이션
│   ├── config.py            # 환경 설정 관리
│   ├── models/
│   │   ├── __init__.py
│   │   └── ocr_model.py     # EasyOCR 래퍼 클래스
│   ├── routers/
│   │   ├── __init__.py
│   │   └── ocr.py           # OCR API 엔드포인트
│   ├── services/
│   │   ├── __init__.py
│   │   └── image_processor.py  # 이미지 전처리
│   └── utils/
│       ├── __init__.py
│       └── logger.py        # 로깅 유틸리티
├── requirements.txt         # Python 의존성
├── .env.example            # 환경 변수 템플릿
├── run.py                  # 서버 실행 스크립트
├── README.md              # 프로젝트 문서
├── INSTALLATION.md        # 설치 가이드
└── .gitignore
```

### 2. 핵심 기능 구현

#### FastAPI 서버 ([main.py](file:///d:/AI_Powered_Drawing_Recognition_Platform/ai-server/app/main.py))
- ✅ CORS 미들웨어 설정 (프론트엔드 연동 준비)
- ✅ Health check 엔드포인트: `GET /health`
- ✅ 자동 API 문서화: `/docs` (Swagger UI)
- ✅ EasyOCR 모델 초기화 및 생명주기 관리

#### EasyOCR 통합 ([ocr_model.py](file:///d:/AI_Powered_Drawing_Recognition_Platform/ai-server/app/models/ocr_model.py))
- ✅ 싱글톤 패턴으로 효율적인 모델 관리
- ✅ 한글 + 영어 동시 지원
- ✅ GPU 가속 지원 (없으면 CPU로 자동 전환)
- ✅ 신뢰도 임계값 필터링 (기본값: 0.3)

#### OCR API 엔드포인트 ([ocr.py](file:///d:/AI_Powered_Drawing_Recognition_Platform/ai-server/app/routers/ocr.py))
- ✅ `POST /api/ocr/extract` - 이미지에서 텍스트 추출
- ✅ 구조화된 JSON 응답 (텍스트, 바운딩 박스, 신뢰도)
- ✅ 다양한 이미지 포맷 지원 (PNG, JPG, JPEG, BMP, TIFF)

#### 이미지 전처리 ([image_processor.py](file:///d:/AI_Powered_Drawing_Recognition_Platform/ai-server/app/services/image_processor.py))
- ✅ OCR 정확도 향상을 위한 자동 전처리
- ✅ 그레이스케일 변환
- ✅ 대비 향상
- ✅ 노이즈 제거
- ✅ 적응형 임계값 처리

### 3. 환경 설정 시스템

`.env` 파일을 통한 유연한 설정:
- `OCR_LANGUAGES`: 지원 언어 (기본값: en, ko)
- `OCR_GPU`: GPU 가속 활성화 여부
- `OCR_CONFIDENCE_THRESHOLD`: 최소 신뢰도 임계값
- `LOG_LEVEL`: 로깅 레벨

---

## ✅ 검증 결과

### Health Check 테스트

```powershell
Invoke-RestMethod -Uri http://localhost:8000/health -Method Get
```

**응답:**
```json
{
    "status": "healthy",
    "ocr": "active",
    "version": "1.0.0"
}
```

### 서버 실행 확인

```
Starting AI Drawing Analysis OCR Server...
Initializing EasyOCR model...
EasyOCR model loaded successfully!
INFO:     Uvicorn running on http://0.0.0.0:8000
INFO:     Application startup complete.
```

### API 문서

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

---

## 🔧 기술 스택

### 주요 의존성
```
fastapi==0.115.6          # 웹 프레임워크
uvicorn[standard]==0.34.0 # ASGI 서버
easyocr==1.7.2           # OCR 엔진
python-multipart==0.0.20  # 파일 업로드
pillow==11.1.0           # 이미지 처리
opencv-python==4.10.0.84  # 컴퓨터 비전
torch==2.5.1             # 딥러닝 프레임워크
```

### 성능 고려사항
- **첫 요청**: 모델 초기화로 인해 느릴 수 있음
- **이후 요청**: 캐시된 모델로 빠른 처리
- **GPU 가속**: 사용 가능 시 성능 대폭 향상
- **이미지 전처리**: 저품질 스캔 이미지의 정확도 향상

---

## 📝 주요 파일 설명

### [run.py](file:///d:/AI_Powered_Drawing_Recognition_Platform/ai-server/run.py)
서버 실행 진입점. Uvicorn을 사용하여 FastAPI 앱을 실행합니다.

### [app/main.py](file:///d:/AI_Powered_Drawing_Recognition_Platform/ai-server/app/main.py)
FastAPI 애플리케이션 정의. CORS 설정, 라우터 등록, 생명주기 이벤트 처리.

### [app/config.py](file:///d:/AI_Powered_Drawing_Recognition_Platform/ai-server/app/config.py)
환경 변수 기반 설정 관리. Pydantic Settings를 사용한 타입 안전성 보장.

### [app/models/ocr_model.py](file:///d:/AI_Powered_Drawing_Recognition_Platform/ai-server/app/models/ocr_model.py)
EasyOCR 모델 래퍼. 싱글톤 패턴으로 메모리 효율성 확보.

### [app/routers/ocr.py](file:///d:/AI_Powered_Drawing_Recognition_Platform/ai-server/app/routers/ocr.py)
OCR API 엔드포인트 정의. 파일 업로드, 이미지 처리, OCR 실행, 결과 반환.

### [app/services/image_processor.py](file:///d:/AI_Powered_Drawing_Recognition_Platform/ai-server/app/services/image_processor.py)
이미지 전처리 로직. OpenCV를 사용한 이미지 품질 향상.

---

## 🚀 다음 단계

### 1. OCR 엔드포인트 실제 테스트
- Swagger UI에서 이미지 업로드 테스트
- 다양한 이미지 포맷 및 품질로 검증
- 한글/영어 혼합 텍스트 인식 확인

### 2. Spring Boot 연동
- **AIServiceClient.java** 생성 - Python 서버와 HTTP 통신
- **OcrService.java** 수정 - Mock 구현을 실제 API 호출로 대체
- **통합 테스트** - 전체 플로우 검증

### 3. 프론트엔드 통합
- `AiRecognitionPage`에서 실제 OCR 결과 확인
- PDF 업로드 → 표제부 선택 → 텍스트 추출 플로우 테스트
- 결과 저장 및 재조회 기능 검증

---

## 💡 배운 점

1. **마이크로서비스 아키텍처**: Python OCR 서버를 독립적으로 구축하여 Spring Boot 백엔드와 분리
2. **FastAPI의 강점**: 자동 문서화, 타입 안전성, 비동기 처리
3. **EasyOCR 최적화**: 싱글톤 패턴으로 모델 재사용, 이미지 전처리로 정확도 향상
4. **환경 설정 관리**: `.env` 파일과 Pydantic Settings로 유연한 설정

---

## 🔗 관련 문서

- [README.md](file:///d:/AI_Powered_Drawing_Recognition_Platform/ai-server/README.md) - 프로젝트 개요
- [INSTALLATION.md](file:///d:/AI_Powered_Drawing_Recognition_Platform/ai-server/INSTALLATION.md) - 설치 가이드
- [Walkthrough](file:///C:/Users/asus/.gemini/antigravity/brain/c4580456-71f8-4cf0-a92f-abfc148e1fd4/walkthrough.md) - 상세 작업 내용

---

**작성자**: AI Assistant  
**상태**: ✅ 완료 (Python 서버 구축 및 검증)  
**다음 작업**: Spring Boot 연동
